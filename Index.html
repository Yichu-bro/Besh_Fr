<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="//data156.click/6ddcc744499b4ed493bc/06c762f6ea/?placementName=default"></script>
    <script src='//libtl.com/sdk.js' data-zone='9832391' data-sdk='show_9832391'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ùêìùêöùê†ùüêùêÇùêöùê¨ùê°</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { /* Styles from previous version */ }
        body.dark-mode { /* Styles from previous version */ }
        body:not(.dark-mode) { /* Styles from previous version */ }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; min-height: 100vh; overflow-x: hidden; transition: background-color 0.3s, color 0.3s; }
        .app-container { max-width: 480px; margin: 0 auto; }
        .header { height: 180px; background: linear-gradient(135deg, #4A90E2, #357ABD); position: relative; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }
        .profile-section { margin-top: -50px; padding: 0 20px; position: relative; z-index: 2; }
        .profile-card { background: var(--card-bg, white); border-radius: 12px; padding: 70px 20px 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 1px solid var(--border-color, #E0E0E0); text-align: center; }
        .profile-pic { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--card-bg, white); object-fit: cover; background: #4A90E2; }
        .content-section { padding: 20px; margin-bottom: 80px; }
        .task-card { background: var(--card-bg, white); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 1px solid var(--border-color, #E0E0E0); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card-bg, white); display: flex; justify-content: space-around; padding: 5px 0; box-shadow: 0 -3px 15px rgba(0,0,0,0.08); z-index: 100; max-width: 480px; margin: 0 auto; border-top: 1px solid var(--border-color, #E0E0E0); border-radius: 12px 12px 0 0; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-secondary, #666); text-decoration: none; font-size: 0.7rem; flex: 1; padding: 5px 0; }
        .nav-item i { font-size: 1.3rem; margin-bottom: 3px; } .nav-item.active { color: var(--primary-color, #4A90E2); }
        .leaderboard-tabs { display: flex; margin-bottom: 20px; border-radius: 8px; background: var(--input-bg); padding: 5px; }
        .leaderboard-tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; border-radius: 6px; font-weight: 500; }
        .leaderboard-tab.active { background: var(--primary-color); color: white; }
        .leaderboard-list .user-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--border-color); }
        .user-item .rank { font-weight: bold; width: 30px; font-size: 1.1rem; color: var(--text-secondary); }
        .user-item .username { flex: 1; font-weight: 500; }
        .user-item .score { font-weight: bold; color: var(--primary-color); }
        /* Include other necessary styles from your original file */
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header & Profile Section (Same as before) -->
        <div class="header">...</div>
        <div class="profile-section">...</div>

        <div class="content-section" id="mainContent"><p>Loading...</p></div>

        <div class="bottom-nav">
            <a href="#" class="nav-item active" data-page="home"><i class="fas fa-home"></i><span>Home</span></a>
            <a href="#" class="nav-item" data-page="tasks"><i class="fas fa-tasks"></i><span>Tasks</span></a>
            <a href="#" class="nav-item" data-page="bonus"><i class="fas fa-gift"></i><span>Bonus</span></a>
            <a href="#" class="nav-item" data-page="leaderboard"><i class="fas fa-trophy"></i><span>Leaders</span></a>
            <a href="#" class="nav-item" data-page="referral"><i class="fas fa-share-alt"></i><span>Referral</span></a>
        </div>
        
        <div class="toast" id="toast"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://besh-b.onrender.com';
        let AppConfig = {}, BonusTasks = [], currentUser = null, userId = null;
        
        document.addEventListener('DOMContentLoaded', async () => { /* Same as before */ });
        async function loadAppConfig() { /* Same as before */ }
        async function loadUserState() { /* Same as before */ }
        async function saveUserState() { /* Same as before */ }
        function updateUI() { /* Update to use AppConfig.currencyName */ }

        function navigateTo(page) {
            const renderFunc = {
                'home': renderHomePage, 'tasks': renderTasksPage,
                'bonus': renderBonusPage, 'leaderboard': renderLeaderboardPage,
                'referral': renderReferralPage
            }[page];
            // ... rest of navigation logic
        }

        // --- Page Renderers ---
        function renderHomePage() {
             mainContent.innerHTML = `
                <div class="task-card">...</div>
                <div class="developer-footer">Developed by <a href="${AppConfig.developerLink || '#'}" target="_blank" class="developer-link">Developer</a></div>`;
        }

        function renderTasksPage() {
            // ... Code is the same, just remove developer footer
        }

        function handleWatchDailyAd() {
            const adFuncName = AppConfig.monetagAdFunction;
            // FIX: Check if the function name string is valid and exists on the window object
            if (adFuncName && typeof adFuncName === 'string' && adFuncName.trim() !== "" && typeof window[adFuncName] === 'function') {
                // ... rest of the ad logic
            } else {
                showToast("Ad service is not configured by the admin.");
            }
        }

        function renderBonusPage() {
            let channelsHtml = BonusTasks.map(task => {
                const isClaimed = currentUser.claimedBonuses?.includes(task.id);
                return `
                    <li class="channel-item">
                        <div class="channel-info">...</div>
                        <button class="btn-claim-bonus" data-task-id="${task.id}" data-channel-id="${task.channelId}" data-reward="${task.reward}" ${isClaimed ? 'disabled' : ''}>${isClaimed ? 'Claimed' : 'Verify & Claim'}</button>
                    </li>`;
            }).join('');
             // ... rest of the render logic
            document.querySelectorAll('.btn-claim-bonus:not([disabled])').forEach(b => b.addEventListener('click', handleBonusClaim));
        }

        async function handleBonusClaim(event) {
            const button = event.currentTarget;
            const { taskId, channelId, reward } = button.dataset;

            if (!channelId || channelId === 'undefined') {
                return showToast("Admin has not set a Channel ID for this task.");
            }

            button.disabled = true;
            button.textContent = 'Verifying...';

            try {
                const res = await fetch(`${API_BASE_URL}/api/verify-membership`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, taskId, channelId, reward: parseInt(reward) })
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.error);
                
                currentUser.points = data.points;
                if (!currentUser.claimedBonuses) currentUser.claimedBonuses = [];
                currentUser.claimedBonuses.push(taskId);
                
                await saveUserState();
                updateUI();
                showToast(`+${reward} ${AppConfig.currencyName || 'Points'} claimed!`);
                button.textContent = 'Claimed';

            } catch (error) {
                showToast(error.message);
                button.disabled = false;
                button.textContent = 'Verify & Claim';
            }
        }
        
        async function renderLeaderboardPage() {
            mainContent.innerHTML = `<div class="task-card"><p>Loading leaderboard...</p></div>`;
            try {
                const res = await fetch(`${API_BASE_URL}/api/leaderboard`);
                const data = await res.json();
                mainContent.innerHTML = `
                    <div class="task-card">
                        <h2 class="section-title"><i class="fas fa-trophy"></i> Leaderboard</h2>
                        <div class="leaderboard-tabs">
                            <div class="leaderboard-tab active" data-board="points">By ${AppConfig.currencyName || 'Points'}</div>
                            <div class="leaderboard-tab" data-board="referrals">By Referrals</div>
                        </div>
                        <div id="points-board" class="leaderboard-list"></div>
                        <div id="referrals-board" class="leaderboard-list" style="display:none;"></div>
                    </div>`;

                const renderBoard = (board, users, unit) => {
                    if (users.length === 0) return board.innerHTML = '<p>No data yet.</p>';
                    board.innerHTML = users.map((user, i) => `
                        <div class="user-item">
                            <div class="rank">${i + 1}</div>
                            <div class="username">${user.username}</div>
                            <div class="score">${user[unit]}</div>
                        </div>`).join('');
                };

                renderBoard(document.getElementById('points-board'), data.byPoints, 'points');
                renderBoard(document.getElementById('referrals-board'), data.byReferrals, 'referrals');
                
                document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelector('.leaderboard-tab.active').classList.remove('active');
                        tab.classList.add('active');
                        document.querySelectorAll('.leaderboard-list').forEach(l => l.style.display = 'none');
                        document.getElementById(`${tab.dataset.board}-board`).style.display = 'block';
                    });
                });
            } catch (error) {
                mainContent.innerHTML = `<div class="task-card"><p>Could not load leaderboard.</p></div>`;
            }
        }

        async function renderReferralPage() { /* Same as before */ }
    </script>
</body>
</html>