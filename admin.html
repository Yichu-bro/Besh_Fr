<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tag2Cash Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f0f2f5; color: #333; margin: 0; }
        .admin-container { display: flex; min-height: 100vh; }
        .sidebar { width: 220px; background: #2c3e50; color: white; padding-top: 20px; flex-shrink: 0; }
        .sidebar h1 { font-size: 1.5rem; text-align: center; margin-bottom: 30px; }
        .sidebar-nav a { display: block; padding: 15px 20px; color: #ecf0f1; text-decoration: none; transition: background 0.3s; border-left: 3px solid transparent; }
        .sidebar-nav a:hover { background: #34495e; }
        .sidebar-nav a.active { background: #3498db; border-left-color: #ecf0f1; }
        .content { flex-grow: 1; padding: 30px; }
        .page { display: none; }
        .page.active { display: block; }
        h2 { border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        .form-section { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; color: #555; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
        button { background-color: #3498db; color: white; border: none; cursor: pointer; padding: 12px 20px; font-size: 1rem; border-radius: 4px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .task { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .btn-delete { background-color: #e74c3c; } .btn-edit { background-color: #f39c12; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="sidebar">
            <h1>Tag2Cash</h1>
            <nav class="sidebar-nav">
                <a href="#settings" class="nav-link active">Settings</a>
                <a href="#tasks" class="nav-link">Bonus Tasks</a>
                <a href="#users" class="nav-link">Users</a>
            </nav>
        </div>
        <div class="content">
            <!-- Settings Page -->
            <div id="settings" class="page active">
                <h2>App Settings</h2>
                <div class="form-section">
                    <h3>Authentication</h3>
                    <label for="adminSecret">Admin Secret Key (Required for all changes)</label>
                    <input type="password" id="adminSecret" placeholder="Enter secret key">
                </div>
                <div class="form-section">
                    <h3>Core Configuration</h3>
                    <div class="grid">
                        <div><label for="currencyName">Currency Name</label><input type="text" id="currencyName" placeholder="e.g., Points, Coins, Gems"></div>
                        <div><label for="adsPerDay">Ads Per Day Limit</label><input type="number" id="adsPerDay"></div>
                        <div><label for="pointsPerAd">Reward per Ad</label><input type="number" id="pointsPerAd"></div>
                        <div><label for="minWithdraw">Minimum Withdraw</label><input type="number" id="minWithdraw"></div>
                        <div><label for="referralBonusReferrer">Referrer Bonus</label><input type="number" id="referralBonusReferrer"></div>
                        <div><label for="referralBonusReferee">Referee Bonus</label><input type="number" id="referralBonusReferee"></div>
                        <div><label for="monetagAdFunction">Monetag Function Name</label><input type="text" id="monetagAdFunction" placeholder="e.g., show_10024038"></div>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Links & IDs</h3>
                    <div class="grid">
                        <div><label for="telegramChatId">Admin Chat ID (for notifications)</label><input type="text" id="telegramChatId" placeholder="e.g., -100..."></div>
                        <div><label for="botLink">Your Bot Link</label><input type="text" id="botLink"></div>
                        <div><label for="webAppUrl">Mini App URL</label><input type="text" id="webAppUrl"></div>
                        <div><label for="developerLink">Developer Telegram Link</label><input type="text" id="developerLink"></div>
                        <div><label for="officialChannel">Official Channel Link</label><input type="text" id="officialChannel"></div>
                        <div><label for="supportGroup">Support Group Link</label><input type="text" id="supportGroup"></div>
                    </div>
                </div>
                <button onclick="saveSettings()">Save All Settings</button>
            </div>
            <!-- Bonus Tasks Page -->
            <div id="tasks" class="page">
                <h2>Bonus Tasks Management</h2>
                <div class="grid">
                    <div class="form-section">
                        <h3>Add / Edit Task</h3>
                        <input type="hidden" id="taskId">
                        <label for="taskName">Task Name</label><input type="text" id="taskName">
                        <label for="taskLink">Task Join Link</label><input type="text" id="taskLink">
                        <label for="taskChannelId">Channel ID (for membership check, e.g., -100...)</label><input type="text" id="taskChannelId">
                        <label for="taskReward">Reward Amount</label><input type="number" id="taskReward">
                        <label for="taskIcon">FontAwesome Icon Class</label><input type="text" id="taskIcon">
                        <button onclick="saveTask()">Save Task</button>
                    </div>
                    <div class="form-section">
                        <h3>Existing Tasks</h3>
                        <div id="tasks-list"></div>
                    </div>
                </div>
            </div>
            <!-- Users Page -->
            <div id="users" class="page">
                <h2>User Management</h2>
                <div class="form-section">
                    <h3>Find User</h3>
                    <label for="findUserId">Enter User's Telegram ID</label>
                    <input type="text" id="findUserId" placeholder="e.g., 123456789">
                    <button onclick="findUser()">Find User</button>
                    <div id="userDetails" style="margin-top:20px;"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const API_BASE_URL = 'https://besh-b.onrender.com';
        // All JavaScript functions for the admin panel are unchanged
        const navLinks = document.querySelectorAll('.nav-link'), pages = document.querySelectorAll('.page');
        navLinks.forEach(link=>{link.addEventListener('click', e=>{e.preventDefault();const t=link.getAttribute('href');navLinks.forEach(l=>l.classList.remove('active')),pages.forEach(p=>p.classList.remove('active')),link.classList.add('active'),document.querySelector(t).classList.add('active')})});
        async function loadData(){try{const[e,t]=await Promise.all([fetch(`${API_BASE_URL}/api/config`),fetch(`${API_BASE_URL}/api/tasks`)]),a=await e.json();for(const n in a)document.getElementById(n)&&(document.getElementById(n).value=a[n]);window.tasksData=await t.json();const d=document.getElementById("tasks-list");for(const o in d.innerHTML="",window.tasksData){const c=window.tasksData[o];d.innerHTML+=`<div class="task"><span>${c.name} (+${c.reward})</span><div><button class="btn-edit" onclick="editTask('${o}')">Edit</button><button class="btn-delete" onclick="deleteTask('${o}')">Delete</button></div></div>`}}catch(r){alert("Failed to load data.")}}
        async function saveSettings(){const e=document.getElementById("adminSecret").value;if(!e)return alert("Secret Key is required.");const t={};document.querySelectorAll("#settings input").forEach(a=>{a.id!=="adminSecret"&&(t[a.id]=a.type==="number"?parseInt(a.value)||0:a.value)});const a=await fetch(`${API_BASE_URL}/api/admin/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:e,newConfig:t})});alert(a.ok?"Settings saved!":"Error saving settings.")}
        function editTask(e){const t=window.tasksData[e];["taskId","taskName","taskLink","taskChannelId","taskReward","taskIcon"].forEach(a=>{document.getElementById(a).value=t[a.replace("task","").toLowerCase()]||""}),document.getElementById("taskId").value=e}
        async function saveTask(){const e=document.getElementById("adminSecret").value;if(!e)return alert("Secret Key is required.");const t={id:document.getElementById("taskId").value||null,name:document.getElementById("taskName").value,link:document.getElementById("taskLink").value,channelId:document.getElementById("taskChannelId").value,reward:parseInt(document.getElementById("taskReward").value),icon:document.getElementById("taskIcon").value};if(!t.name||!t.reward)return alert("Task Name and Reward are required.");if(!t.channelId.startsWith("-"))return alert('Channel ID must be a negative number.');const a=await fetch(`${API_BASE_URL}/api/admin/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:e,task:t})});a.ok?(alert("Task saved!"),["taskId","taskName","taskLink","taskChannelId","taskReward","taskIcon"].forEach(d=>document.getElementById(d).value=""),loadData()):alert("Error saving task.")}
        async function deleteTask(e){const t=document.getElementById("adminSecret").value;if(!t)return alert("Secret Key is required.");if(!confirm("Are you sure?"))return;const a=await fetch(`${API_BASE_URL}/api/admin/tasks/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:t,taskId:e})});a.ok?(alert("Task deleted!"),loadData()):alert("Error deleting task.")}
        async function findUser(){const e=document.getElementById("adminSecret").value,t=document.getElementById("findUserId").value,a=document.getElementById("userDetails");if(!e||!t)return alert("Secret Key and User ID are required.");a.innerHTML="Searching...";const d=await fetch(`${API_BASE_URL}/api/admin/find-user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:e,userId:t})});d.ok?a.innerHTML=`<h4>${(await d.json()).username} (ID: ${t})</h4>...<button onclick="updateBalance('${t}')">Update</button>`:a.innerHTML='<p style="color:red;">User not found.</p>'}
        async function updateBalance(e){const t=document.getElementById("adminSecret").value,a=document.getElementById("newBalance").value,d=await fetch(`${API_BASE_URL}/api/admin/update-balance`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:t,userId:e,newBalance:Number(a)})});d.ok?(alert("Balance updated!"),findUser()):alert("Failed to update.")}
        window.onload=loadData;
    </script>
</body>
</html>